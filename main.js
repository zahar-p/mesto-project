(()=>{"use strict";var e={},t=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))};function n(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&y()}function o(e){"Escape"===e.key&&y()}var r=document.querySelector(".profile__title-text"),c=document.querySelector(".profile__description"),a=document.querySelector(".profile__image"),i=document.querySelector(".profile__image-overlay"),s=document.querySelector("#display-picture"),u=document.querySelector("#edit-profile-window"),l=document.querySelector("#change-avatar"),d=document.querySelector("#add-card-window"),f=s.querySelector(".popup__image"),m=s.querySelector(".popup__image-description"),p=document.querySelectorAll(".popup");function v(e){e.addEventListener("keydown",o),e.classList.toggle("popup_visible")}function _(e){e.classList.toggle("popup_visible"),e.removeEventListener("keydown",o)}function h(e){var t=e.target.src,n=e.target.alt;f.src=t,f.alt=n,m.textContent=n,v(s)}function y(){p.forEach((function(e){e.classList.contains("popup_visible")&&_(e)}))}var b="https://nomoreparties.co/v1",S="plus-cohort-16",g={authorization:"251b89ee-22ba-4226-b520-08a3b73f3e6c","Content-Type":"application/json"},E=["likes","_id","name","link","owner"];var k=document.querySelector(".elements"),C=document.querySelector("#card-template");function L(e,t){k.prepend(function(e,t){var n=t.likes,o=t._id,r=t.name,c=t.link,a=t.owner,i=(function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}}(t,E),C.content.querySelector(".element").cloneNode(!0)),s=i.querySelector(".element__like-counter"),u=i.querySelector(".element__image"),l=i.querySelector(".element__delete"),d=i.querySelector(".element__like");return i.id=o,i.querySelector(".element__text").textContent=r,u.src=c,u.alt=r,u.addEventListener("click",h),s.textContent=n.length,l.dataset.cardId=o,d.dataset.cardId=o,a._id!==e&&l.classList.add("element__delete_hidden"),n.some((function(t){return t._id===e}))&&d.classList.add("element__like_checked"),l.addEventListener("click",x),d.addEventListener("click",q),i}(e,t))}function q(e){var t,n=e.target,o=n.nextElementSibling,r=null;n.classList.contains("element__like_checked")?r=function(e){return fetch("".concat(b,"/").concat(S,"/cards/likes/").concat(e),{method:"DELETE",headers:g})}(n.dataset.cardId):(t=n.dataset.cardId,r=fetch("".concat(b,"/").concat(S,"/cards/likes/").concat(t),{method:"PUT",headers:g})),r.then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){n.classList.toggle("element__like_checked"),o.textContent=e.likes.length})).catch((function(e){console.log(e)}))}function x(e){var t;(t=e.target.dataset.cardId,fetch("".concat(b,"/").concat(S,"/cards/").concat(t),{method:"DELETE",headers:g})).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status));e.target.closest(".element").remove()})).catch((function(e){console.log("Error: ".concat(e))}))}var j,P="",O="Сохранение...",w=document.querySelector(".profile__edit-button"),A=document.querySelector(".profile__add-button"),T=u.querySelector(".popup__submit-button"),B=l.querySelector(".popup__submit-button"),I=d.querySelector(".popup__submit-button");function D(e,t){r.textContent=e,c.textContent=t}function N(e){a.src=e}w.addEventListener("click",(function(){document.forms["edit-profile"].name.value=r.textContent,document.forms["edit-profile"].description.value=c.textContent,v(u)})),A.addEventListener("click",(function(){document.forms["add-card"].reset(),v(d)})),i.addEventListener("click",(function(){document.forms["change-avatar"].url.value=a.src,v(l)})),document.forms["edit-profile"].addEventListener("submit",(function(e){var t,n;e.preventDefault(),t=document.forms["edit-profile"].name.value,n=document.forms["edit-profile"].description.value,I.textContent=O,function(e,t){return fetch("".concat(b,"/").concat(S,"/users/me"),{method:"PATCH",headers:g,body:JSON.stringify({name:e,about:t})})}(t,n).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){D(e.name,e.about)})).catch((function(e){console.log("Error: ".concat(e))})).finally(T.textContent="Сохранить"),_(u)})),document.forms["add-card"].addEventListener("submit",(function(t){var n,o,r;t.preventDefault(),I.textContent=O,(n=document.forms["add-card"].name.value,o=document.forms["add-card"].url.value,fetch("".concat(b,"/").concat(S,"/cards"),{method:"POST",headers:g,body:JSON.stringify({name:n,link:o})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){L(P,e)})).catch((function(e){console.log("Error: ".concat(e))})).finally(I.textContent="Создать"),_(d),document.forms.reset,(r=document.forms["add-card"].querySelector(".popup__submit-button")).disabled=!0,r.classList.add(e.inactiveButtonClass)})),document.forms["change-avatar"].addEventListener("submit",(function(e){e.preventDefault();var t=document.forms["change-avatar"].url.value;B.textContent=O,function(e){return fetch("".concat(b,"/").concat(S,"/users/me/avatar"),{method:"PATCH",headers:g,body:JSON.stringify({avatar:e})})}(t).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status));N(t)})).catch((function(e){console.log("Error: ".concat(e))})).finally(B.textContent="Сохранить"),_(l)})),p.forEach((function(e){e.addEventListener("click",n)})),e=j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){var n=e.querySelector(j.submitButtonSelector),o=Array.from(e.querySelectorAll(j.inputSelector));t(o,n,j),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.patternErrorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,j),t(o,n,j)}))}))})),fetch("".concat(b,"/").concat(S,"/users/me"),{headers:g}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t,n,o,r,c;n=(t=e).about,o=t.avatar,t.cohort,r=t.name,c=t._id,P=c,N(o),D(r,n)})).catch((function(e){console.log("Error: ".concat(e))})),fetch("".concat(b,"/").concat(S,"/cards"),{headers:g}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){return L(P,e)}))})).catch((function(e){console.log("Error: ".concat(e))}))})();